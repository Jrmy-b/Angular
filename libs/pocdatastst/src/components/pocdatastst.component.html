<section class="pocdatastst">
  <mat-grid-list cols="1" rowHeight="150">
    <mat-card class="ng-section">
      <mat-card-header class="section-header">
        <mat-card-title> Configuration </mat-card-title>
      </mat-card-header>
      <mat-card-content class="section-content">
        <form flex="100" fxLayout="column" fxLayoutGap="20px" [formGroup]="form" novalidate autocomplete="off" (ngSubmit)="onSubmit(form)"
          #f="ngForm">
          <div fxLayout="row" fxLayoutAlign="space-around">
            <div class="panel panel-y" fxFlex="40">
              <div class="panel-heading">
                Available APIs
              </div>
              <div *ngIf="!executing" class="panel-body" dnd-sortable-container [dropZones]="['boxers-zone']" [sortableData]="availableApis">
                <ul class="list-group">
                  <li *ngFor="let api of availableApis; let i = index" class="list-group-item" dnd-sortable [sortableIndex]="i">
                    <span class="type">{{api.name}}</span>
                    <span class="pull-right" (click)="addItem(api)"><i class="fa fa-arrow-right"></i></span>
                  </li>
                </ul>
              </div>
              <div *ngIf="executing" class="panel-body">
                <ul class="list-group">
                  <li *ngFor="let api of availableApis; let i = index" class="list-group-item">
                    <span class="type">{{api.name}}</span>
                  </li>
                </ul>
              </div>
            </div>
            <div fxLayout="column" fxFlex="20" fxLayoutAlign="center center" fxLayoutGap="20px">
              <div class="button-row">
                <button mat-raised-button type="button" color="primary" (click)="addAllApis()" [disabled]="executing">
                  <span class="type">All</span>
                  <span class="pull-right"><i class="fa fa-arrow-right"></i></span>
              </button>
              </div>
              <div class="button-row">
                <button mat-raised-button type="button" color="primary" (click)="resetSelectedApis()" [disabled]="executing">
                  <span class="type">Reset</span>
                  <span class="pull-right"><i class="fa fa-undo"></i></span>
              </button>
              </div>
            </div>



            <div class="panel panel-g" fxFlex="40">
              <div class="panel-heading">
                Selected Apis
              </div>
              <div *ngIf="!executing" class="panel-body" dnd-sortable-container [dropZones]="['boxers-zone']" [sortableData]="selectedApis">
                <ul class="list-group">
                  <li *ngFor="let selectedApi of selectedApis; let i = index" class="list-group-item" dnd-sortable [sortableIndex]="i">
                    {{selectedApi.name}}
                    <span class="pull-right" (click)="removeItem(selectedApi)"><i class="fa fa-times"></i></span>
                  </li>
                </ul>
              </div>
              <div *ngIf="executing" class="panel-body">
                <ul class="list-group">
                  <li *ngFor="let selectedApi of selectedApis" class="list-group-item">
                    {{selectedApi.name}}
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div fxLayout="row" fxLayoutAlign="center center">
            <div class="errorMsgBlock">
              <span class="error" *ngIf="f.submitted && selectedApis.length === 0"><br>You must select at least one API</span>
              <span class="error" *ngFor="let msg of errorMsg"><br>{{msg}}</span>
            </div>
          </div>

          <div *ngIf="inputsList.length > 0" class="panel panel-b" fxFlex="100">
            <div class="panel-heading">
              Inputs
            </div>
            <!-- INPUTS LOOP -->
            <div class="panel-body" fxLayout="column">
              <div *ngFor="let input of inputsList; let i = index" [ngSwitch]="input.kind">
                <div *ngSwitchCase="'toggle-switch'" fxLayout="row" fxFlex="100" fxLayoutGap="10px" fxLayoutAlign="start center">
                  <div [ngClass]="{'selected': !input.checkedState }">
                    {{input.label.uncheckedState}}
                  </div>
                  <div class="slide-toggle-container">
                    <mat-slide-toggle name={{input.keyToggle}} formControlName={{input.keyToggle}} (change)="changeToggleSwitchPlaceholder($event, input)"></mat-slide-toggle>
                  </div>
                  <div [ngClass]="{'selected': input.checkedState }">
                    {{input.label.checkedState}}
                  </div>
                  <div class="slide-toggle-input">
                    <mat-input-container class="example-full-width">
                      <input matInput placeholder="{{input.checkedState ? input.placeholders.checkedState : input.placeholders.uncheckedState}}"
                        name={{input.key}} formControlName={{input.key}}>
                    </mat-input-container>
                  </div>
                </div>
                <div *ngSwitchCase="'select'" fxLayout="row" fxFlex="100" fxLayoutGap="20px" fxLayoutAlign="start center">
                  <div>
                    {{input.label}}
                  </div>
                  <div>
                    <mat-select name="{{input.key}}" formControlName="{{input.key}}">
                      <mat-option *ngFor="let item of input.values" [value]="item.key">
                        {{item.label}}
                      </mat-option>
                    </mat-select>
                  </div>
                </div>
                <div *ngSwitchCase="'textArea'" class="base dark" fxLayout="row" fxFlex="100">
                  <mat-input-container class="mat-icon-float mat-block" fxFlex="100" show-errors>
                    <textarea matInput matTextareaAutosize placeholder="Enter your text here" rows="10" name="{{input.key}}" formControlName="{{input.key}}"></textarea>
                  </mat-input-container>
                </div>
              </div>
            </div>
          </div>

          <!-- ERRORS LOOP -->
          <div fxLayout="column" fxLayoutAlign="center center">
            <div *ngFor="let input of inputsList; let i = index">
              <div *ngIf="form.contains(input.key)" class="errorMsgBlock">
                <div *ngFor="let validator of input.validators">
                  <div *ngIf="validator.required">
                    <span class="error" *ngIf="f.submitted && form.get(input.key).hasError('required')"><br/>{{input.key}} {{validator.required.errorMsg}}</span>
                  </div>
                  <div *ngIf="validator.numberValue">
                    <span class="error" *ngIf="form.get(input.key).hasError('numberValue')"><br/>{{input.key}} {{validator.numberValue.errorMsg}} </span>
                  </div>
                  <div *ngIf="validator.minValue">
                    <span class="error" *ngIf="form.get(input.key).hasError('minValue')"><br/>{{validator.minValue.errorMsg}} {{input.key}} : {{form.get(input.key).getError('minValue').min}}</span>
                  </div>
                  <div *ngIf="validator.maxValue">
                    <span class="error" *ngIf="form.get(input.key).hasError('maxValue')"><br/>{{validator.maxValue.errorMsg}} {{input.key}} : {{form.get(input.key).getError('maxValue').max}}</span>
                  </div>
                  <div *ngIf="validator.minLength">
                    <span class="error" *ngIf="form.get(input.key).hasError('minLength')"><br/>{{validator.minLength.errorMsg}} {{input.key}} : {{form.get(input.key).getError('minLength').min}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="inputsList.length > 0" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="20px">
            <div>
              <button mat-raised-button color="primary" [disabled]="!f.valid || executing">
                <i class="fa fa-play"></i>
              </button>
            </div>
            <div>
              <button mat-raised-button color="primary" type="button" (click)="stopExecution(form)" [disabled]="!executing">
                <i class="fa fa-stop"></i>
              </button>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <mat-card *ngIf="displayResult" class="ng-section">
      <mat-card-header class="section-header">
        <mat-card-title> Outputs </mat-card-title>
      </mat-card-header>
      <mat-card-content class="section-content">
        <div fxFlex="100">
          <div class="collapsable-list" *ngFor="let exec of executions; let execIndex = index">
            <div fxLayout="column" class="collapsable" [ngSwitch]="exec.code">
              <div id="apiCall-{{execIndex}}" fxLayout="row" fxFlex="100" class="collapsable-header" (click)="toggleOpen($event, execIndex)">
                <div fxFlex="auto">{{exec.name}}</div>
                <div fxLayout="row" fxFlex="20" fxLayoutAlign="end center" [ngSwitch]="exec.status">
                  <div *ngSwitchCase="runningStatus" fxLayout="row">
                    <div id="spinnerInside">
                      <div></div>
                    </div>
                  </div>
                  <mat-icon *ngSwitchCase="okStatus" class="mat-24 fa-lg" svgIcon="navigation:ic_check_24px"></mat-icon>
                  <mat-icon *ngSwitchCase="koStatus" class="mat-24 fa-lg" svgIcon="navigation:ic_close_24px"></mat-icon>
                  <mat-icon *ngSwitchCase="cancelledStatus" class="mat-24 fa-lg" svgIcon="content:ic_undo_24px"></mat-icon>
                </div>
              </div>
              <div *ngSwitchCase="'SENSE'" [ngClass]="{'collapsable-body': exec.isOpened, 'collapsable-body2': !exec.isOpened}">
                <div *ngIf="exec.isOpened">
                      <div fxLayout="column" fxLayoutGap="10px">
                        <div fxLayout="row" fxLayoutAlign="center">
                          <div>
                              <gauge-chart [dataInput]="exec.result"></gauge-chart>
                          </div>
                        </div>
                        <div>
                          <b>Sentimental analysis : </b>
                      </div>
                        <div>
                            <span [innerHTML]="exec.result | sentimentDisplay | lineBreaks"></span>
                        </div>
                      </div>
                </div>
              </div>
              <div *ngSwitchCase="'SUMMARIZE'" [ngClass]="{'collapsable-body': exec.isOpened, 'collapsable-body2': !exec.isOpened}">
                  <div *ngIf="exec.isOpened">
                        <div fxLayout="column" fxLayoutGap="5px">
                          <div fxLayout="row" fxLayoutAlign="center">
                            <div fxFlex="100">
                                <ngx-sum-gauge-chart [dataInput]="exec.result"></ngx-sum-gauge-chart>
                            </div>
                          </div>
                          <div *ngFor="let entry of exec.result">
                              <span *ngIf="!entry.hidden">
                                <b *ngIf="entry.label">{{entry.label}} : </b>
                                <span><div [innerHTML]="entry.message | lineBreaks"></div></span>
                              </span>
                            </div>
                        </div>
                  </div>
                </div>
              <div *ngSwitchCase="'ENTITY'" [ngClass]="{'collapsable-body': exec.isOpened, 'collapsable-body2': !exec.isOpened}">
                  <div *ngIf="exec.isOpened">
                    <span>
                      <b>Recognition : </b>
                      <span [innerHTML]="exec.result | recognitionDisplay | lineBreaks"></span>
                    </span>
                  </div>
                </div>
              <div *ngSwitchDefault [ngClass]="{'collapsable-body': exec.isOpened, 'collapsable-body2': !exec.isOpened}">
                  <ng-container *ngIf="exec.isOpened">
                      <div *ngFor="let entry of exec.result">
                          <span *ngIf="!entry.hidden">
                            <b *ngIf="entry.label">{{entry.label}} : </b>
                            <span><div [innerHTML]="entry.message | lineBreaks"></div></span>
                          </span>
                        </div>
                  </ng-container>


              </div>
            </div>
          </div>

          <!-- With Angular Material Beta 10, there is a corresponding input -->
          <!--
          <mat-accordion multi="true">
            <mat-expansion-panel *ngFor="let exec of executions; let execIndex = index" [expanded]="execIndex == executions.length-1 && exec.status !== runningStatus">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div fxLayout="row" fxLayoutAlign="center center">
                    <div id="apiCall-{{execIndex}}">{{exec.name}}</div>
                  </div>
                </mat-panel-title>
                <mat-panel-description [ngSwitch]="exec.status">
                  <div fxLayout="row" fxFlex="100" fxLayoutAlign="end end">
                    <div *ngSwitchCase="runningStatus" fxLayout="row">
                      <div id="spinnerInside">
                        <div></div>
                      </div>
                    </div>
                    <mat-icon *ngSwitchCase="okStatus" class="mat-24 fa-lg" fontSet="fa" fontIcon="fa-check"></mat-icon>
                    <mat-icon *ngSwitchCase="koStatus" class="mat-24 fa-lg" fontSet="fa" fontIcon="fa-times"></mat-icon>
                    <mat-icon *ngSwitchCase="cancelledStatus" class="mat-24 fa-lg" fontSet="fa" fontIcon="fa-undo"></mat-icon>
                  </div>
                </mat-panel-description>
              </mat-expansion-panel-header>

              <div *ngFor="let entry of exec.result">
                <span><b *ngIf="entry.key">{{entry.key}} : </b> {{entry.message}}</span>
               </div>
            </mat-expansion-panel>
          </mat-accordion>
        -->

        </div>


      </mat-card-content>
    </mat-card>
  </mat-grid-list>
</section>
